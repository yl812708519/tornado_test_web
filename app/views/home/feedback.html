{% extends "../layouts/application.html" %}
{% block left %}
{% end %}
{% block body %}
<div class="container" style="margin-top: 100px;margin-bottom:100px;">
    <div class="row">
        <div class="col-xs-12">
            <form action="/feedback" method="post">
                {% raw xsrf_form_html() %}
                <h3 style="color: #0c84d8">意见反馈</h3>
                <textarea style="width:100%;height:400px;" name="content" id="content" placeholder="请填写意见" ></textarea>
                <input type="button" class="btn btn-success" value="提交" id="demo">
            </form>
        </div>
    </div>
</div>
{% end %}
{% block javascript %}
<script>
    var editor;
    KindEditor.ready(function (K) {
        editor = K.create('textarea#content', {
            uploadJson: '/feedback/uploadfile?_xsrf=' + getCookie("_xsrf")+"&ossName=yestar",
            allowFileManager: false,
            afterCreate: function () {
                var self = this;
                K.ctrl(document, 13, function () {
                    self.sync();
                    document.forms['example'].submit();
                });
                K.ctrl(self.edit.doc, 13, function () {
                    self.sync();
                    document.forms['example'].submit();
                });
            }
        });
        prettyPrint();
    })
    $("#demo").click(function(){
        $.ajax({
            type:"post",
            data:{content:editor.html(),_xsrf:getCookie("_xsrf")},
            url:"/feedback",
            beforeSend:function(){
//                alert("loading");
            },
            success:function(data){
                alert('错误已提交, 我们会尽快修改');
//                if(data.result==1){
//                    window.location.href='/';
//                    //alert("提交成功");
//                }else{
//                    //alert("ERROR")
//                }
            },
            error:function(){
            },
            complete:function(){
//                alert("complete")
            }
        })
    });
</script>
{% end %}