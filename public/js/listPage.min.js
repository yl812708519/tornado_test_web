/*! ekinginc 2014-10-16 */
function buildWtableHeight(){if(wTableOptions.TABLEHEIGHT)return void $(".wtable-data").css("height",wTableOptions.TABLEHEIGHT+"px");$(".content-main").css("overflow","hidden");var a=$(".wtable-con").parent().height(),b=$(".wtable-tools").height(),c=$(".wtable-top-more").height(),d=$(".wtable-head").height(),e=$(".wtable-footer").height();wTableOptions.SHOWTOPBAR||(b=-10),wTableOptions.SHOWBOTTOMBAR||(e=-8);var f=a-22-b-c-d-e;$(".wtable-data").css("height",f+"px")}function wTable(a){function b(){$(".wtable-data").scroll(function(){$(this).parent().find(".wtable-head").scrollLeft($(this).scrollLeft())}),wTableOptions.ENTERSEARCH&&$(".wtable-tools input").keydown(function(a){13==a.keyCode&&d({currentPage:1})}),$(".wtable-head th.sortable").click(function(){var a=$(this).find("span.glyphicon "),b=i($(this).attr("data-options")).field,c="asc";a.hasClass("glyphicon-chevron-down")?(a.removeClass("glyphicon-chevron-down"),a.addClass("glyphicon-chevron-up"),c="asc"):(a.removeClass("glyphicon-chevron-up"),a.addClass("glyphicon-chevron-down"),c="desc"),alert(b+":"+c)}),$("#search").click(function(){d({currentPage:1})}),$("#senior-search").click(function(){var a=$(".wtable-search.wtable-senior-search");a.hasClass("hide")?(a.removeClass("hide"),$(this).html("简易搜索"),$(".wtable-search").not(".wtable-senior-search").addClass("hide")):($(this).html("高级搜索"),a.addClass("hide"),$(".wtable-search").not(".wtable-senior-search").removeClass("hide")),buildWtableHeight()}),$(".page-size-group ul li a").click(function(){$(this).parent().addClass("disabled").siblings().removeClass("disabled");var a=$(this).html();$(".page-size-group #page_size").html(a),d({currentPage:1,pageSize:a})}),$(".pagination #page_first").click(function(){return $(this).parent().hasClass("disabled")?!1:void d({currentPage:1})}),$(".pagination #page_pre").click(function(){if($(this).parent().hasClass("disabled"))return!1;var a=parseInt($(".page_msg #current_page").val());d({currentPage:a-1})}),$(".pagination #page_last").click(function(){return $(this).parent().hasClass("disabled")?!1:void d({currentPage:$("#total_page").html()})}),$(".pagination #page_next").click(function(){if($(this).parent().hasClass("disabled"))return!1;var a=parseInt($(".page_msg #current_page").val());d({currentPage:a+1})}),$(".page_msg #current_page").keydown(function(a){if(13==a.keyCode){var b=parseInt($(".page_msg #total_page").html()),c=$(this).val();c||(c=1),c=c>b?b:c,d({currentPage:c})}}),$(".wtable-footer #exportAll").click(function(){if(!wTableOptions.EXPORTALLURL)return void wModalDialog({content:"导出路径未配置！",showAnimate:!0,type:"alert"});var a=c();a.exportType="all",$.ajax({type:"get",async:!1,url:wTableOptions.EXPORTALLURL,data:a,beforeSend:function(){$(".loading").show()},success:function(a){window.location.href=a.result},complete:function(){$(".loading").hide()},error:function(){}})}),$(".wtable-footer #exportSelected").click(function(){if(!wTableOptions.EXPORTURL)return void wModalDialog({content:"导出路径未配置！",showAnimate:!0,type:"alert"});var a=h();a?$.ajax({type:"get",async:!1,url:wTableOptions.EXPORTURL,data:{ids:a,exportType:"selected"},beforeSend:function(){$(".loading").show()},success:function(a){window.location.href=a.result},complete:function(){$(".loading").hide()},error:function(){}}):wModalDialog({content:"请选择您要导出的记录！",showAnimate:!0,type:"alert"})}),$(".wtable-footer #footer_delete").click(function(){if(!wTableOptions.DELETEURL)return void wModalDialog({content:"删除URL未配置！",showAnimate:!0,type:"alert"});var a=h();if(a){var b=a.split(",").length-1;wModalDialog({content:"您确定要删除选中的"+b+"条记录吗？",showAnimate:!0,type:"confirm",sureCallBack:function(){var b={};b._method="delete",b.ids=a,b._xsrf=getCookie("_xsrf"),$.ajax({type:"post",async:!1,url:wTableOptions.DELETEURL,data:b,beforeSend:function(){$(".loading").show()},success:function(){d()},complete:function(){$(".loading").hide()},error:function(){}})}})}else wModalDialog({content:"请选择您要删除的记录！",showAnimate:!0,type:"alert"})}),$(".wtable-footer #footer_add").click(function(){wTableOptions.ADDURL?location.href=wTableOptions.ADDURL:alert("配置错误：系统默认添加按钮路径addUrl未配置")})}function c(a){var b={};return b.current_page=parseInt($(".page_msg #current_page").val())||1,b.page_size=$("#page_size").html()||15,a&&a.currentPage&&(b.current_page=a.currentPage),a&&a.pageSize&&(b.page_size=a.pageSize),a&&a.sortField&&(b.sort_field=a.sortField,b.sort_type=a&&a.sortType?a.sortType:"desc"),$(".wtable-tools input").each(function(a,c){if(!$(c).parent().hasClass("hide")){var d=$(c).attr("name"),e=$(c).val();b[d]=e}}),b}function d(a){if(!wTableOptions.DATAURL){var b=wTableOptions.DATA;return wTableOptions.RESULT=b,e({currentPage:b.current_page,totalCount:b.total_count,pageSize:b.page_size}),void f(b)}var d=c(a);$.ajax({type:"get",async:!1,url:wTableOptions.DATAURL,data:d,beforeSend:function(){$(".loading").show()},success:function(a){wTableOptions.RESULT=a,e({currentPage:a.current_page,totalCount:a.total_count,pageSize:a.page_size}),f(a)},complete:function(){$(".loading").hide()},error:function(){}})}function e(a){var b=a.currentPage||0,c=a.totalCount||0,d=a.pageSize||10,e=0,f=!0,g=!0;e=Math.ceil(c/d),1>=b&&(f=!1),b>=e&&(g=!1),$(".wtable-footer .pagination .pageNum").parent().remove();var h=1,i=1,j=e;for(e>5&&(3>=b?j=5:b>3&&(2>e-b?(i=e-4,j=e):(i=b-2,j=b+2))),h=i;j>=h;h++)$(".wtable-footer .pagination #page_next").parent().before('<li><a href="javascript:;" id = "'+h+'" class="pageNum">'+h+"</a></li>");$(".wtable-footer .pagination .pageNum#"+b).parent().addClass("disabled"),f?($(".wtable-footer .pagination #page_first").parent().removeClass("disabled"),$(".wtable-footer .pagination #page_pre").parent().removeClass("disabled")):($(".wtable-footer .pagination #page_first").parent().addClass("disabled"),$(".wtable-footer .pagination #page_pre").parent().addClass("disabled")),g?($(".wtable-footer .pagination #page_last").parent().removeClass("disabled"),$(".wtable-footer .pagination #page_next").parent().removeClass("disabled")):($(".wtable-footer .pagination #page_last").parent().addClass("disabled"),$(".wtable-footer .pagination #page_next").parent().addClass("disabled")),$(".wtable-footer #page_size ").html(d),$(".wtable-footer .page_msg #current_page ").val(b),$(".wtable-footer .page_msg #total_page ").html(e),$(".wtable-footer .page_msg #total_count ").html(c)}function f(a){if($(".wtable-data .table tbody ").html(""),!a||!a.list||0==a.list.length)return g(),$(".empty-data").remove(),void $(".wtable-data").append('<div class="empty-data" style="text-align: center;line-height: 100px; position: absolute;top:0px;left:0px;width:100%;height:100%;background-color:rgba(0,0,0,0.01)">暂无数据</div>');var b=a;if(wTableOptions.DATAFILTER)for(var c=0;c<b.list.length;c++){var e=b.list[c];b.list[c]=wTableOptions.DATAFILTER(e)}var f=b.list;if(wTableOptions.UNIQUE_FIELD=b.unique_field,f&&f.length>0){$(".wtable-data .empty-data").remove();for(var c=0;c<f.length;c++){for(var h="<tr>",i=f[c],j=0;j<wTableOptions.FIELDS.length;j++){var k=wTableOptions.FIELDS[j],l=i[k];l=l?l:"";var m="";if(0==j){var n=i[wTableOptions.UNIQUE_FIELD];h="<tr unique_id='"+n+"'>",m+='<input type="hidden" name="id" value="'+n+'"/>'}var o="<td class='data-cell'><div class='text_off' title='"+l+"'>"+l+"</div>"+m+"</td>",p=$(o).text();h+="<td class='data-cell'><div class='text_off' title='"+p+"'>"+l+"</div>"+m+"</td>"}h+="</tr>",$(".wtable-data .table tbody ").append(h)}}else $(".empty-data").remove(),$(".wtable-data").append('<div class="empty-data" style="text-align: center;line-height: 100px; position: absolute;top:0px;left:0px;width:100%;height:100%;background-color:rgba(0,0,0,0.01)">暂无数据</div>');g(),wTableOptions.ONCLICKCELL&&$(".wtable-data tr td.data-cell").click(function(a){wTableOptions.ONCLICKCELL($(this),wTableOptions.RESULT.list[$(this).parent().index()],a)}),wTableOptions.LOADCOMPLETE&&wTableOptions.LOADCOMPLETE(b),$(".pagination .pageNum").click(function(){if($(this).parent().hasClass("disabled"))return!1;var a=$(this).attr("id");d({currentPage:a})}),$(".wtable-data .edit").click(function(){if(wTableOptions.EDITURL){var a=$(this).parents("tr").find("input[name=id]").val();location.href=wTableOptions.EDITURL+"?"+wTableOptions.UNIQUE_FIELD+"="+a}else alert("配置错误：系统默认编辑按钮路径editUrl未配置")}),$(".wtable-data .delete").click(function(){var a=$(this).parents("tr").find("input[name=id]").val();wModalDialog({content:"您确定要删除此条记录吗？",showAnimate:!0,type:"confirm",sureCallBack:function(){var b={};b._method="delete",b.ids=a,b._xsrf=getCookie("_xsrf"),$.ajax({type:"post",async:!1,url:wTableOptions.DELETEURL,data:b,beforeSend:function(){$(".loading").show()},success:function(){d()},complete:function(){$(".loading").hide()},error:function(){}})}})}),$(".wtable-data .detail").click(function(){var a=$(this).parents("tr").find("input[name=id]").val();alert("详情"+a)})}function g(){if($(".wtable input").iCheck("uncheck"),$(".wtable-head th.wtable-check").length&&($(".wtable-head th.wtable-check").find("div.text_off").length||$(".wtable-head th.wtable-check").html('<div class="text_off">'+$(".wtable-head th.wtable-check").html()+"</div>"),$(".wtable-data tr").each(function(){$(this).prepend('<td class="wtable-check"><div class="text_off"><input type="checkbox" name="check_id"/></div></td>')})),$(".wtable-head th.wtable-oper").length){var a=$(".wtable-head th.wtable-oper").attr("data-options");if(void 0!=a){var b=i(a),c="",d="";for(var e in b)"width"!=e?c+='<button type="button" class="btn btn-success btn-xs '+e+'">'+b[e]+"</button>":d=b[e];$(".wtable-data tr").each(function(a,b){$(b).append('<td class="wtable-oper"><div class="text_off" style="width:'+d+'px">'+c+"</div></td>")})}else $(".wtable-data tr").each(function(a,b){$(b).append('<td class="wtable-oper"><div class="text_off"  ><button type="button" class="btn btn-success btn-xs edit">编辑</button></div></td>')})}$(".wtable-head th").each(function(a,b){var c=$(b).attr("data-options");if(void 0!=c){var d=i(c);d.width&&($(this).html("<div class='text_off' style='width:"+d.width+"px' orw = "+d.width+" title='"+$(this).text()+"'>"+$(this).text()+"</div>"),$(this).css("width",d.width),$(".wtable-data tr").each(function(){$(this).find("td:eq("+a+")").css("width",d.width),$(this).find("td:eq("+a+")").find("div.text_off").attr("style","width:"+d.width+"px").attr("orw",d.width)})),d.align&&$(".wtable-data tr").each(function(){$(this).find("td:eq("+a+")").css("text-align","center"),$(this).find("td:eq("+a+")").find("div.text_off").css("text-align",d.align)}),d.sort&&"true"==d.sort&&($(this).find("span.glyphicon").length||($(this).addClass("sortable"),$(this).append('<span class="glyphicon "></span>')))}}),$(".wtable-check").length&&($("input[type=checkbox]").iCheck({checkboxClass:"icheckbox_square-blue",radioClass:"iradio_square-blue",increaseArea:"20%"}),$("input[name=main_check]").on("ifChecked",function(){$("input[name=check_id]").iCheck("check")}),$("input[name=main_check]").on("ifUnchecked",function(){$("input[name=check_id]").iCheck("uncheck")}))}function h(a){var b="";return"all"==a?($(".wtable-data input[name=id]").each(function(){b+=$(this).val()+","}),b):($(".wtable-data tr td.wtable-check").each(function(a,c){$(c).find("div").hasClass("checked")&&(b+=$(c).next().find("input[name=id]").val()+",")}),b)}function i(a){for(var b={},c=a.split(","),d=0;d<c.length;d++){var e=c[d].split(":"),f=e[0],g=e[1];b[f]=g}return b}if(wTableOptions={},wTableOptions.FIELDS=[],wTableOptions.UNIQUE_FIELD=a.unique_field||"id",wTableOptions.RESULT,wTableOptions.SHOWTOPBAR=void 0==a.showTopBar?!0:a.showTopBar,wTableOptions.SHOWBOTTOMBAR=void 0==a.showBottomBar?!0:a.showBottomBar,wTableOptions.SHOWPAGINATION=void 0==a.showPagination?!0:a.showPagination,wTableOptions.ENTERSEARCH=void 0==a.enterSearch?!0:a.enterSearch,wTableOptions.DATA=a.data,wTableOptions.TABLEHEIGHT=a.tableHeight,wTableOptions.SHOWBORDER=void 0==a.showBorder?!0:a.showBorder,wTableOptions.DATAURL=a.dataUrl,wTableOptions.ADDURL=a.addUrl,wTableOptions.DELETEURL=a.deleteUrl,wTableOptions.EXPORTURL=a.exportUrl,wTableOptions.EXPORTALLURL=a.exportAllUrl,wTableOptions.DETAILURL=a.detailUrl,wTableOptions.EDITURL=a.editUrl,wTableOptions.LOADCOMPLETE=a.onDataLoaded,wTableOptions.DATAFILTER=a.dataFilter,wTableOptions.ONCLICKCELL=a.onClickCell,wTableOptions.SHOWTOPBAR||$(".wtable-tools").hide(),wTableOptions.SHOWBOTTOMBAR||$(".wtable-footer").hide(),wTableOptions.SHOWPAGINATION||$(".page-size-group,.pagination,.page_msg").hide(),wTableOptions.SHOWBORDER||$("div.wtable ").css("border","0px"),$(".wtable-head th.wtable-col").each(function(a,b){var c=$(b).attr("data-options");if(void 0!=c){var d=i(c);wTableOptions.FIELDS.push(d.field)}}),d({currentPage:1}),b(),buildWtableHeight(),!wTableOptions.TABLEHEIGHT){var j;$(window).resize(function(){j&&clearTimeout(j),j=setTimeout("buildWtableHeight();",50)})}var k={};return k.getAllRowIds=function(){var a=[];return $(".wtable-data input[name=id]").each(function(){a.push($(this).val())}),a},k.getSelectedRowIds=function(){var a=[];return $(".wtable-data tr td.wtable-check").each(function(b,c){$(c).find("div").hasClass("checked")&&a.push($(c).next().find("input[name=id]").val())}),a},k.getSelectedRows=function(){var a=[];return $(".wtable-data tr").each(function(b,c){$(c).find("td.wtable-check div.checked").length&&a.push(wTableOptions.RESULT.list[$(c).index()])}),a},k.getSearchConditions=c,k}