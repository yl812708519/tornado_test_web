/*! ekinginc 2015-09-11 */
function getStyle(a,b){return window.getComputedStyle?getComputedStyle(a,!1)[b]:a.currentStyle[b]}function move(a,b,c){c=c||{},c.time=c.time||300,c.type=c.type||"ease-out";var d={},e={},f=Math.round(c.time/30),g=0;for(var h in b)d[h]=parseFloat(getStyle(a,h)),e[h]=parseInt(b[h])-d[h];clearInterval(a.timer),a.timer=setInterval(function(){g++;for(var h in b){switch(c.type){case"linear":var i=d[h]+e[h]*g/f;break;case"ease-in":var j=g/f,i=d[h]+e[h]*j*j*j;break;case"ease-out":var j=1-g/f,i=d[h]+e[h]*(1-j*j*j)}"opacity"==h?(a.style.opacity=i,a.style.filter="alpha(opacity:"+100*i+")"):a.style[h]=i+"px"}g==f&&clearInterval(a.timer)},30)}function elastic(a,b,c){a.speed=a.speed||0,a.cur=a.cur||0,a.timer=null,clearInterval(a.timer),a.timer=setInterval(function(){a.speed+=(c-a.cur)/5,a.speed*=.7,a.cur+=a.speed,a.style[b]=Math.round(a.cur)+"px",Math.round(a.cur)==c&&0==Math.round(a.speed)&&clearInterval(a.timer)},30)}function drag(a){a.onmousedown=function(b){b=b||event;var c=b.clientX-a.offsetLeft,d=b.clientY-a.offsetTop;return document.onmousemove=function(b){b=b||event,a.style.left=b.clientX-c+"px",a.style.top=b.clientY-d+"px"},document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null,a.releaseCapture&&a.releaseCapture()},a.setCaputure&&a.setCaputure(),!1}}function toss(a){a.onmousedown=function(b){this.style.opacity="1",this.style.filter="alpha(opacity:100)",b=b||event,redOnlyIndex=window.redOnlyIndex||0,redOnlyIndex++,a.style.zIndex=redOnlyIndex;var c=a.offsetLeft,d=a.offsetTop,e=b.clientX-c,f=b.clientY-d,g=0,h=0;return clearInterval(a.timer),document.onmousemove=function(b){b=b||event;var i=b.clientX-e,j=b.clientY-f;g=i-c,h=j-d,c=i,d=j,0>i?i=0:i>document.documentElement.clientWidth-a.offsetWidth?i=document.documentElement.clientWidth-a.offsetWidth:0>j?j=0:j>document.documentElement.clientHeight-a.offsetHeight&&(j=document.documentElement.clientHeight-a.offsetHeight),a.style.left=i+"px",a.style.top=j+"px"},document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null,clearInterval(a.timer),a.timer=setInterval(function(){h+=3;var b=a.offsetLeft,c=a.offsetTop;b+=g,c+=h,c>document.documentElement.clientHeight-a.offsetHeight?(c=document.documentElement.clientHeight-a.offsetHeight,h*=-.8,g*=.8):0>c?(c=0,h*=-.8,g*=.8):b>document.documentElement.clientWidth-a.offsetWidth?(b=document.documentElement.clientWidth-a.offsetWidth,g*=-.8,h*=.8):0>b&&(b=0,g*=-.8),Math.abs(g)<1&&(g=0),Math.abs(h)<1&&(h=0),c==document.documentElement.clientHeight-a.offsetHeight&&0==g&&0==h&&(clearInterval(a.timer),a.style.opacity="0.3",this.style.filter="alpha(opacity:30)"),a.style.left=b+"px",a.style.top=c+"px"},30),a.releaseCapture&&a.releaseCapture()},a.setCapture&&a.setCapture(),!1}}function collTest(a,b){var c=a.offsetLeft,d=a.offsetTop,e=c+a.offsetWidth,f=d+a.offsetHeight,g=b.offsetLeft,h=b.offsetTop,i=g+b.offsetWidth,j=h+b.offsetHeight;return g>e||h>f||c>i||d>j?!1:!0}function addMouseWheel(a,b){function c(a){a=a||event;var c=a.wheelDelta?a.wheelDelta<0:a.detail>0;b&&b(c)}navigator.userAgent.toLowerCase().indexOf("firefox")>-1?a.addEventListener("DOMMousescroll",c,!1):a.onmousewheel=c}function move_img(a,b,c){function d(c){c.onmousedown=function(d){k="",d=d||event;var e=d.clientX-c.offsetLeft,f=d.clientY-c.offsetTop;return document.onmousemove=function(a){a=a||event,c.style.left=a.clientX-e+"px",c.style.top=a.clientY-f+"px";var b=g(c);if(b&&b!=c){var d=c.index,h=b.index;if(h>d)for(var k=0;k<i.length;k++)i[k].index>=d+1&&i[k].index<=h&&(i[k].index--,move(i[k],j[i[k].index]));else for(var k=0;k<i.length;k++)i[k].index>=h&&i[k].index<=d-1&&(i[k].index++,move(i[k],j[i[k].index]));c.index=h}},document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null,move(c,j[c.index]),c.releaseCapture&&c.releaseCapture();for(var d=0;d<i.length;d++)$("#"+a).children().eq(d).attr("index",i[d].index),k+=k?","+i[d].index:""+i[d].index;$("#"+b).attr("value",k)},c.setCapture&&c.setCapture(),!1}}function e(a,b){var c=a.offsetLeft,d=a.offsetTop,e=a.offsetLeft+a.offsetWidth,f=a.offsetTop+a.offsetHeight,g=j[b.index].left,h=j[b.index].top,i=j[b.index].left+b.offsetWidth,k=j[b.index].top+b.offsetHeight;return g>e||c>i||h>f||d>k?!1:!0}function f(a,b){var c=a.offsetLeft-j[b.index].left,d=a.offsetTop-j[b.index].top;return Math.sqrt(c*c+d*d)}function g(a){for(var b=9999999,c=-1,d=0;d<i.length;d++)if(e(a,i[d])){var g=f(a,i[d]);b>g&&(b=g,c=d)}return-1==c?null:i[c]}for(var h=document.getElementById(a),i=h.children,j=[],k="",l=0,m=i.length;m>l;l++)i[l].index=l,j.push({left:i[l].offsetLeft,top:i[l].offsetTop}),i[l].style.left=j[l].left+"px",i[l].style.top=j[l].top+"px";for(var l=0,m=i.length;m>l;l++)i[l].style.position="absolute",i[l].style.margin="0";for(var l=0,m=i.length;m>l;l++)d(i[l]);for(var l=0;l<i.length;l++)$("#"+a).children().eq(l).attr("index",i[l].index);$(".delete_img").unbind(),$(".delete_img").click(function(){var a=$(this).parents(".file").attr("index"),b=$(this).parents(".file").index();$("#files_img input").eq(b).remove();var c=$("#sequence").val().split(","),d="";i="",i=h.children;for(var e=0;e<c.length;e++)c[e]!=a&&(c[e]>a?(d+=","+(c[e]-1),i[e].index=c[e]-1):(d+=","+c[e],i[e].index=c[e]),c[e]>a&&$("#files_img .file").eq(e).attr("index",$("#files_img .file").eq(e).attr("index")-1));d=d.substring(1);var f=d.split(",");$(this).parents(".file").remove(),$("#sequence").attr("value",d);for(var e=0;e<i.length;e++)move(i[e],j[f[e]]);$("#files_img .file").length<5&&$("#iFrameUpload_img").removeAttr("disabled"),$("#files_img .file").length<1&&$("#files_img").css("display","none")})}function moves(a,b){$("#iFrameUpload_img").wIFrameUpload({url:"/iframe_upload",ossName:"yestar",openPositionInterval:!0,beforeSubmit:function(a){var b=a.val(),c=["gif","jpeg","jpg","bmp","png"];return RegExp(".("+c.join("|")+")$","i").test(b.toLowerCase())?"disabled"==$("#iFrameUpload_img").attr("disabled")?!1:($("#files_img .file").removeAttr("style"),$("#iFrameUpload_img").html("正在上传中..."),$("#iFrameUpload_img").attr("disabled","disabled"),$("#files_img").append('<div class="file" state="load"><div style="position:relative"><span class="glyphicon glyphicon-remove delete_img" style="position:absolute;top:-12px;left:87px;color:red"></span><img class="imgs" style="width:100px;height:100px;" src="/s/img/load.gif"></div></div>'),$("#files_img").css("display","block"),!0):(alert("选择文件错误,图片类型必须是(gif,jpeg,jpg,bmp,png)中的一种"),!1)},success:function(c){if(1==c.status){var d="";if($("#files_img").find("div[state=load]").remove(),$("#files_img").append('<div class="file" state="success"><div style="position:relative"><span class="glyphicon glyphicon-remove delete_img" style="position:absolute;top:-12px;left:87px;color:red"></span><img class="imgs" style="width:100px;height:100px;" src="'+c.downloadUrl+'"><input type="hidden" name="'+a+'" value="'+c.ossUrl+'"></div></div>'),$("#files_img input").length>4?$("#iFrameUpload_img").attr("disabled","disabled"):$("#iFrameUpload_img").removeAttr("disabled"),$("#iFrameUpload_img").html("请选择图片上传"),1==$("#files_img input").length&&$("#files_img").css("display","block"),b){$("#"+b.btn_id).attr("value","111");var e=$("#"+b.form_id).data("bootstrapValidator");e.revalidateField(b.check_name)}move_img("files_img","sequence"),$("#files_img .file").css("cursor","pointer");for(var f=0;f<$("#files_img .file").length;f++)d+=d?","+$("#files_img .file").eq(f).attr("index"):""+$("#files_img .file").eq(f).attr("index");$("#sequence").attr("value",d)}else alert(c.message)}})}